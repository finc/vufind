<!-- finc: search - advanced - ranges -->
<? /* There is another slider in recommend - sidefacets but both should be identical - CK */ ?>
<? if (isset($this->ranges) && !empty($this->ranges)): ?>
  <? $params = $this->searchParams($this->searchClassId);
  $params->activateAllFacets(); ?>
  <? foreach ($this->ranges as $current): $escField = $this->escapeHtmlAttr($current['field']); ?>
    <? $extraInputAttribs = ($current['type'] == 'date') ? 'maxlength="4" ' : ''; ?>
    <? /* use xs-cols to improve mobile view, finc-specific, CK */ ?>
    <fieldset class="col-xs-11 col-sm-4">
    <legend><?= $this->transEsc($params->getFacetLabel($current['field'])) ?></legend>
    <input type="hidden" name="<?= $this->escapeHtmlAttr($current['type']) ?>range[]" value="<?= $escField ?>"/>
    <div class="row">
      <div class="col-sm-6">
        <label for="<?= $escField ?>from"><?= $this->transEsc('date_from') ?>:</label>
          <input type="text" name="<?=$escField?>from" id="<?=$escField?>from" value="<?=isset($current['values'][0])?$this->escapeHtmlAttr($current['values'][0]):''?>" class="form-control" <?=$extraInputAttribs?>/>
      </div>
      <div class="col-sm-6">
        <label for="<?= $escField ?>to"><?= $this->transEsc('date_to') ?>:</label>
          <input type="text" name="<?=$escField?>to" id="<?=$escField?>to" value="<?=isset($current['values'][1])?$this->escapeHtmlAttr($current['values'][1]):''?>" class="form-control" <?=$extraInputAttribs?>/>
      </div>
    </div>
    <? if ($current['type'] == 'date'): ?>
      <div class="slider-container">
        <input type="text" id="<?= $escField ?><?= $this->escapeHtmlAttr($current['type']) ?>Slider">
      </div>
      <?
      $this->headScript()->appendFile('vendor/bootstrap-slider.js');
          $this->headLink()->appendStylesheet('vendor/bootstrap-slider.min.css');
      $min = !empty($current['values'][0]) ? min($current['values'][0], 1400) : 1400;
      $future = date('Y', time() + 31536000);
      $max = !empty($current['values'][1]) ? max($future, $current['values'][1]) : $future;
      $low = !empty($current['values'][0]) ? $current['values'][0] : $min;
      $high = !empty($current['values'][1]) ? $current['values'][1] : $max;
      $min = intval($min);
      $max = intval($max);
      $low = intval($low);
      $high = intval($high);
      $reversed = $this->layout()->rtl ? 'true' : 'false';
      $init = !empty($current['values'][0]) ? 'fillTexts()' : '';
      $script = <<<JS
$(document).ready(function() {
  var fillTexts = function() {
	var v = {$escField}dateSlider.getValue();
	$('#${escField}from').val(v[0]);
	$('#${escField}to').val(v[1]);
  };
  var {$escField}dateSlider = $('#{$escField}dateSlider')
	.slider({
	  'min':{$min},
	  'max':{$max},
	  'handle':"square",
	  'tooltip':"hide",
      'value':[{$low},{$high}],
      'reversed': {$reversed}
	})
    .on('change', fillTexts)
	.data('slider');
  {$init}
});
// finc-specific: Update slider handle position with input date; CK
$('#{$escField}from, #{$escField}to').change(function () {
  var from = Number($('#{$escField}from').val());
  var to   = Number($('#{$escField}to').val());
  if (from <= 0) {
    from = {$min};
  }
  if (to <= 0) {
    to = {$max};
  }
  $('#{$escField}dateSlider').slider('setValue', [from, to], true);
});
JS;
      ?>
      <?= $this->inlineScript(\Zend\View\Helper\HeadScript::SCRIPT, $script, 'SET'); ?>
      </fieldset>
    <? endif; ?>
  <? endforeach; ?>
<? endif; ?>
<!-- finc: search - advanced - ranges - END -->
